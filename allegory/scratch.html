<html>
  <head>
    <style>
    </style>
  </head>
  <body>
    <div id="logs"></div>
  </body>
  <script>

    class Logger {
      static add(text) {
        let logs = document.querySelector('#logs')
        let div = document.createElement('div')
        div.innerText = text
        logs.appendChild(div)
      }
    }

    function determineRoll(percent) {
      return Math.random() < percent
    }

    class Character {
      constructor(params) {
        this.name = params.name
        this.determineRoll = params.determineRoll
        this.hp = params.hp
        this.attackPower = params.attackPower
        this.criticalHit = params.criticalHit
        this.hit = params.hit
        this.guard = params.guard
      }

      get isAlive() {
        return this.hp > 0
      }

      get isDead() {
        return !this.isAlive
      }

      attack(enemy) {
        Logger.add(`${this.name} attacks ${enemy.name}...`)

        let critialHit = false
        if (this.determineRoll(this.hit)) {
          if (this.determineRoll(enemy.guard)) {
            if (this.determineRoll(this.criticalHit)) {
              Logger.add(`${this.name} does a critical hit!`)
              critialHit = true
            }

            let atk
            if (critialHit) {
              atk = 2 * this.attackPower
            } else {
              atk = this.attackPower
            }

            Logger.add(`${this.name} does ${atk} damage to ${enemy.name}`)
            enemy.hp -= atk
          } else {
            Logger.add(`${enemy.name} blocks ${this.name}'s attack`)
          }
        } else {
          Logger.add(`${this.name} misses ${enemy.name}`)
        }

        return null
      }
    }

    class Enemy extends Character {}

    character1 = new Character({
      name: 'Boris',
      determineRoll: determineRoll,
      hp: 20,
      attackPower: 2,
      criticalHit: 0.02,
      hit: 0.90,
      guard: 0.10
    })

    character2 = new Character({
      name: 'Rocky',
      determineRoll: determineRoll,
      hp: 20,
      attackPower: 2,
      criticalHit: 0.02,
      hit: 0.90,
      guard: 0.10
    })

    enemy1 = new Enemy({
      name: 'Natasha',
      determineRoll: determineRoll,
      hp: 10,
      attackPower: 1,
      criticalHit: 0.02,
      hit: 0.85,
      guard: 0.05
    })

    class Battle {
      constructor(params) {
        this.party = params.party
        this.enemeies = params.enemeies
      }

      run() {
        let fighting = true
        while(fighting) {
          let characterRoundOrder = this.setOrder(shuffledParty, shuffledEnemies)

          for (let i = 0; i < characterRoundOrder.length - 1; i++) {
            for (let j = 0; i < characterRoundOrder[i].length - 1; j++) {
              let character = characterRoundOrder[i][j]
              if (character === null ||character === undefined) { continue }

              let randomEnemy = this.getRandomEnemy(character)

              character.attack(randomEnemy)
            }

            if (this.isPartyDead(this.party)) {
              fighting = false
              return this.enemeies
            }

            if (this.isPartyDead(this.enemeies)) {
              fighting = false
              return this.party
            }
          }
        }
      }

      getRandomEnemy(character) {
        let enemy
        if (character.constructor.name === 'Character') {
          enemy = this.enemeies[Math.floor(Math.random() * this.enemeies.length)]
        } else {
          enemy = this.party[Math.floor(Math.random() * this.party.length)]
        }

        if (enemy === null) {
          return this.getRandomEnemy(character)
        }

        return enemy
      }

      isPartyDead(partyArray) {
        for (let i = 0; i < partyArray; i++) {
          if (character.isAlive) {
            return false
          }
        }

        return true
      }
    }

    battle = new Battle({ party: [character1, character2], enemeies: [enemy1] })
    winner = battle.run()

  </script>
</html>