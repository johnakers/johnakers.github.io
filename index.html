<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <!-- epsilon font via: adrian wrobel (https://www.adrianwrobel.com/store/p/epsilon-typeface) -->
    <!-- background model via integra (https://surrealutopia.com/downloads/) -->
    <!-- menu sound is "Menu Sound 2" from Wipeout HD Fury -->

    <div id="content">
      <div id="name">johnakers</div>
      <hr>
      <button>data</button>
      <button>links</button>
      <button>blog</button>
    </div>

    <div id="navigation">
      <hr>
      <span id="left">&#10568;</span>
      <span id="text">navigation</span>
    </div>

    <div id="main">
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
    </div>

    <!-- background animation -->
    <div id="p5"></div>

    <script>
      let pointer = 0;
      let buttons = document.querySelectorAll('button');
      let lines = document.querySelectorAll('.line');

      class TextToWrite {
        constructor() {
          let data = [
            'software engineer'.split(''),
            'construction manager'.split(''),
            'introverted'.split(''),
            'eclectic'.split(''),
            ' '.split(''),
            'welcome'.split('')
          ];

          let links = [
            '@_johnakers'.split(''),
            'in/akersjohn'.split(''),
            'github.com/johnakers'.split('')
          ];

          let blog = [
            'coming soon'.split('')
          ];

          this.text = {
            0: data,
            1: links,
            2: blog
          };
        }

      }

      // p5
      let p5Canvas;
      let inaura;

      function preload() {
        inaura = loadModel('Integra - INAURA.obj', true);
      }

      function setup() {
        let options = {
          preventDefault: true
        };

        // document.body registers gestures anywhere on the page
        let hammer = new Hammer(document.body, options);
        hammer.get('swipe').set({
          direction: Hammer.DIRECTION_ALL
        });

        hammer.on("swipe", swiped);

        p5Canvas = createCanvas(window.innerWidth, window.innerHeight, WEBGL);
        p5Canvas.parent('p5');
      }

      function draw() {
        // buttons
        for (let i = 0; i < buttons.length; i++) {
          let b = buttons[i];
          b.style.backgroundColor = 'transparent';
        }

        buttons[pointer].style.backgroundColor = 'blue';

        // background animation
        let rotationSpeed = frameCount * 0.001;

        background(30);

        translate(width / 5, 0)
        noStroke()
        ambientLight(30);
        pointLight(0, 30, 160, mouseX - width / 2, mouseY - height / 2, 100)
        scale(4);
        rotateX(rotationSpeed);
        rotateY(rotationSpeed);
        rotateZ(rotationSpeed);
        specularMaterial(250);
        shininess(90);
        model(inaura);
      }

      function keyPressed() {
        if (keyCode === LEFT_ARROW) {
          clearText();

          pointer--

          if (pointer < 0) {
            pointer = 2
          }

          playMenuSound();
          writeText();
        }

        if (keyCode === RIGHT_ARROW) {
          clearText();

          pointer++

          if (pointer > 2) {
            pointer = 0
          }

          playMenuSound();
          writeText();
        }
      }

      function swiped(event) {
        if (event.direction == 4) { // right
          clearText();

          pointer++

          if (pointer > 2) {
            pointer = 0
          }

          playMenuSound();
          writeText();
        } else if (event.direction == 2) { // left
          clearText();

          pointer--

          if (pointer < 0) {
            pointer = 2
          }

          playMenuSound();
          writeText();
        }
      }

      function playMenuSound() {
        let audio = new Audio('menu.mp3');
        audio.play();
      }

      function clearText() {
        for (let i = 0; i < lines.length; i++) {
          lines[i].innerText = '';
        }
      }

      function writeText() {
        let textToWrite = new TextToWrite().text;

        for (let i = 0; i < lines.length; i++) {
          let line = lines[i];
          let t = textToWrite[pointer][i];
          drawLine(t, line);
        }
      }

      function drawLine(array, line) {
        let interval = setInterval(() => {
          if (array !== undefined) {
            if (array.length > 0) {
              line.innerText += array.shift();
            }

            if (array.length === 0) {
              clearInterval(interval);
            }
          }

        }, 20);
      }

      writeText()
    </script>
  </body>
</html>
